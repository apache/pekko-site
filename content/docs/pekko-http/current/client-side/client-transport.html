<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Apache Pekko Http: Modern, fast, asynchronous, streaming-first HTTP server and client.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Apache Pekko Http: Modern, fast, asynchronous, streaming-first HTTP server and client.">
<link rel="shortcut icon" href="../assets/images/pekko_favicon.png">
<title>Pluggable Client Transports / HTTP(S) proxy Support · Apache Pekko HTTP</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="../assets/stylesheets/pekko-theme.css">
</head>
<body
data-md-color-primary="white"
data-md-color-accent="orange"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Apache Pekko HTTP" class="md-header-nav__button md-logo">
<img src="../assets/images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko HTTP
</span>
<span class="md-header-nav__topic">
Pluggable Client Transports / HTTP(S) proxy Support
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko-http"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko-http
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Apache Pekko HTTP" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../assets/images/pekko_logo.png" width="24" height="24">
</a>
<a href="../index.html" title="Apache Pekko HTTP">
Apache Pekko HTTP
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko-http"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko-http
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="../security.html" class="page">! Security Announcements !</a>
  <ul>
    <li><a href="../security.html#receiving-security-advisories" class="header">Receiving Security Advisories</a></li>
    <li><a href="../security.html#reporting-vulnerabilities" class="header">Reporting Vulnerabilities</a></li>
    <li><a href="../security.html#references" class="header">References</a></li>
  </ul></li>
  <li><a href="../release-notes/index.html" class="page">0. Release Notes</a></li>
  <li><a href="../introduction.html" class="page">1. Introduction</a>
  <ul>
    <li><a href="../introduction.html#philosophy" class="header">Philosophy</a></li>
    <li><a href="../introduction.html#using-apache-pekko-http" class="header">Using Apache Pekko HTTP</a></li>
    <li><a href="../introduction.html#routing-dsl-for-http-servers" class="header">Routing DSL for HTTP servers</a></li>
    <li><a href="../introduction.html#marshalling" class="header">Marshalling</a></li>
    <li><a href="../introduction.html#streaming" class="header">Streaming</a></li>
    <li><a href="../introduction.html#low-level-http-server-apis" class="header">Low-level HTTP server APIs</a></li>
    <li><a href="../introduction.html#http-client-api" class="header">HTTP Client API</a></li>
    <li><a href="../introduction.html#the-modules-that-make-up-apache-pekko-http" class="header">The modules that make up Apache Pekko HTTP</a></li>
  </ul></li>
  <li><a href="../usage.html" class="page">2. Usage</a>
  <ul>
    <li><a href="../configuration.html" class="page">Configuration</a></li>
    <li><a href="../migration-guide/index.html" class="page">Migration Guides</a></li>
    <li><a href="../compatibility-guidelines.html" class="page">Compatibility Guidelines</a></li>
  </ul></li>
  <li><a href="../common/index.html" class="page">3. Data Types &amp; Abstractions</a>
  <ul>
    <li><a href="../common/http-model.html" class="page">HTTP Model</a></li>
    <li><a href="../common/uri-model.html" class="page">The URI model</a></li>
    <li><a href="../common/marshalling.html" class="page">Marshalling</a></li>
    <li><a href="../common/unmarshalling.html" class="page">Unmarshalling</a></li>
    <li><a href="../common/encoding.html" class="page">Encoding / Decoding</a></li>
    <li><a href="../common/json-support.html" class="page">JSON Support</a></li>
    <li><a href="../common/xml-support.html" class="page">XML Support</a></li>
    <li><a href="../common/sse-support.html" class="page">Server-Sent Events Support</a></li>
    <li><a href="../common/timeouts.html" class="page">Timeouts</a></li>
    <li><a href="../common/caching.html" class="page">Caching</a></li>
  </ul></li>
  <li><a href="../server-side/index.html" class="page">4. Server API</a>
  <ul>
    <li><a href="../routing-dsl/index.html" class="page">Routing DSL</a></li>
    <li><a href="../server-side/low-level-api.html" class="page">Core Server API</a></li>
    <li><a href="../server-side/websocket-support.html" class="page">Server WebSocket Support</a></li>
    <li><a href="../server-side/server-https-support.html" class="page">Server HTTPS Support</a></li>
    <li><a href="../server-side/graceful-termination.html" class="page">Graceful termination</a></li>
    <li><a href="../server-side/http2.html" class="page">Server-Side HTTP/2 (Preview)</a></li>
  </ul></li>
  <li><a href="../client-side/index.html" class="page">5. Client API</a>
  <ul>
    <li><a href="../client-side/configuration.html" class="page">Configuration</a></li>
    <li><a href="../client-side/request-and-response.html" class="page">HttpRequest and HttpResponse</a></li>
    <li><a href="../client-side/request-level.html" class="page">Request-Level Client-Side API</a></li>
    <li><a href="../client-side/host-level.html" class="page">Host-Level Client-Side API</a></li>
    <li><a href="../client-side/connection-level.html" class="page">Connection-Level Client-Side API</a></li>
    <li><a href="../client-side/pool-overflow.html" class="page">Pool overflow and the max-open-requests setting</a></li>
    <li><a href="../client-side/client-https-support.html" class="page">Client-Side HTTPS Support</a></li>
    <li><a href="../client-side/client-transport.html#pluggable-client-transports-http-s-proxy-support" class="active page">Pluggable Client Transports / HTTP(S) proxy Support</a></li>
    <li><a href="../client-side/websocket-support.html" class="page">Client-Side WebSocket Support</a></li>
    <li><a href="../client-side/http2.html" class="page">Client-Side HTTP/2 (Preview)</a></li>
  </ul></li>
  <li><a href="../extensions.html" class="page">6. Extensions</a></li>
  <li><a href="../technologies.html" class="page">7. Supported Technologies</a>
  <ul>
    <li><a href="../technologies.html#http" class="header">HTTP</a></li>
    <li><a href="../technologies.html#https" class="header">HTTPS</a></li>
    <li><a href="../technologies.html#websocket" class="header">WebSocket</a></li>
    <li><a href="../technologies.html#http-2" class="header">HTTP/2</a></li>
    <li><a href="../technologies.html#dns" class="header">DNS</a></li>
    <li><a href="../technologies.html#multipart" class="header">Multipart</a></li>
    <li><a href="../technologies.html#server-sent-events-sse-" class="header">Server-sent Events (SSE)</a></li>
    <li><a href="../technologies.html#json" class="header">JSON</a></li>
    <li><a href="../technologies.html#xml" class="header">XML</a></li>
    <li><a href="../technologies.html#gzip-and-deflate-content-encoding" class="header">Gzip and Deflate Content-Encoding</a></li>
  </ul></li>
  <li><a href="../tipsandtricks.html" class="page">8. Tips And Tricks</a>
  <ul>
    <li><a href="../troubleshooting/index.html" class="page">Troubleshooting</a></li>
    <li><a href="../handling-blocking-operations-in-pekko-http-routes.html" class="page">Handling blocking operations in Apache Pekko HTTP</a></li>
    <li><a href="../implications-of-streaming-http-entity.html" class="page">Implications of the streaming nature of Request/Response Entities</a></li>
  </ul></li>
  <li><a href="../contributing.html" class="page">9. Contributing</a>
  <ul>
    <li><a href="../contributing.html#welcome-" class="header">Welcome!</a></li>
    <li><a href="../contributing.html#snapshots" class="header">Snapshots</a></li>
  </ul></li>
  <li><a href="../reference.html" class="page">10. Reference</a>
  <ul>
    <li><a href="../reference.html#api-documentation" class="header">API Documentation</a></li>
    <li><a href="../reference.html#directives" class="header">Directives</a></li>
    <li><a href="../reference.html#books" class="header">Books</a></li>
  </ul></li>
</ul>

<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../client-side/client-transport.html#pluggable-client-transports-http-s-proxy-support" class="header">Pluggable Client Transports / HTTP(S) proxy Support</a>
  <ul>
    <li><a href="../client-side/client-transport.html#configuring-client-transports" class="header">Configuring Client Transports</a></li>
    <li><a href="../client-side/client-transport.html#predefined-transports" class="header">Predefined Transports</a></li>
    <li><a href="../client-side/client-transport.html#custom-host-name-resolution-transport" class="header">Custom Host Name Resolution Transport</a></li>
    <li><a href="../client-side/client-transport.html#implementing-custom-transports" class="header">Implementing Custom Transports</a></li>
  </ul></li>
</ul>
</nav>


<ul class="md-nav__list md-nav__links">
<li class="md-nav__item"><a href="https://apache.org"><i class="md-icon">link</i> Apache Software Foundation</a></li>
<li class="md-nav__item"><a href="https://apache.org/licenses/"><i class="md-icon">link</i>&nbsp;License</a></li>
<li class="md-nav__item"><a href="https://apache.org/security/"><i class="md-icon">link</i>&nbsp;Security</a></li>
<li class="md-nav__item"><a href="https://www.apache.org/foundation/sponsorship.html"><i class="md-icon">link</i>&nbsp;Donate</a></li>
<li class="md-nav__item"><a href="https://www.apache.org/foundation/thanks.html"><i class="md-icon">link</i>&nbsp;Thanks</a></li>
</ul>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.0.0+4308-98f0ff9c*
</label>
</li>
</ul>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../client-side/client-transport.html#pluggable-client-transports-http-s-proxy-support" class="header">Pluggable Client Transports / HTTP(S) proxy Support</a>
  <ul>
    <li><a href="../client-side/client-transport.html#configuring-client-transports" class="header">Configuring Client Transports</a></li>
    <li><a href="../client-side/client-transport.html#predefined-transports" class="header">Predefined Transports</a></li>
    <li><a href="../client-side/client-transport.html#custom-host-name-resolution-transport" class="header">Custom Host Name Resolution Transport</a></li>
    <li><a href="../client-side/client-transport.html#implementing-custom-transports" class="header">Implementing Custom Transports</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#pluggable-client-transports-http-s-proxy-support" name="pluggable-client-transports-http-s-proxy-support" class="anchor"><span class="anchor-link"></span></a>Pluggable Client Transports / HTTP(S) proxy Support</h1>
<p>The client side infrastructure has support to plug different transport mechanisms underneath (the API may still change in the future). A client side transport is represented by an instance of <span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/ClientTransport.html" title="org.apache.pekko.http.scaladsl.ClientTransport"><code>org.apache.pekko.http.scaladsl.ClientTransport</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/ClientTransport.html" title="org.apache.pekko.http.javadsl.ClientTransport"><code>org.apache.pekko.http.javadsl.ClientTransport</code></a></span>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/http-core/src/main/scala/org/apache/pekko/http/scaladsl/ClientTransport.scala#L37-L41" target="_blank" title="Go to snippet source">source</a><code class="language-scala">@ApiMayChange
trait ClientTransport {
  def connectTo(host: String, port: Int, settings: ClientConnectionSettings)(
      implicit system: ActorSystem): Flow[ByteString, ByteString, Future[OutgoingConnection]]
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/http-core/src/main/scala/org/apache/pekko/http/javadsl/ClientTransport.scala#L37-L41" target="_blank" title="Go to snippet source">source</a><code class="language-scala">@ApiMayChange
abstract class ClientTransport {
  def connectTo(host: String, port: Int, settings: ClientConnectionSettings, system: ActorSystem)
      : Flow[ByteString, ByteString, CompletionStage[OutgoingConnection]]
}</code></pre></dd>
</dl>
<p>A transport implementation defines how the client infrastructure should communicate with a given host.</p><div class="callout note "><div class="callout-title">Note</div>
<p>In our model, SSL/TLS runs on top of the client transport, even if you could theoretically see it as part of the transport layer itself.</p></div>
<h2><a href="#configuring-client-transports" name="configuring-client-transports" class="anchor"><span class="anchor-link"></span></a>Configuring Client Transports</h2>
<p>A <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/ClientTransport.html" title="org.apache.pekko.http.javadsl.ClientTransport"><code>ClientTransport</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/ClientTransport.html" title="org.apache.pekko.http.scaladsl.ClientTransport"><code>ClientTransport</code></a></span> can be configured in the <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/settings/ClientConnectionSettings.html" title="org.apache.pekko.http.javadsl.settings.ClientConnectionSettings"><code>ClientConnectionSettings</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/settings/ClientConnectionSettings.html" title="org.apache.pekko.http.scaladsl.settings.ClientConnectionSettings"><code>ClientConnectionSettings</code></a></span>. Right now, this is not possible through config files but only by code. First, use <code>ClientConnectionSettings.withTransport</code> to configure a transport, then use <code>ConnectionPoolSettings.withConnectionSettings</code>. <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/settings/ClientConnectionSettings.html" title="org.apache.pekko.http.javadsl.settings.ClientConnectionSettings"><code>ClientConnectionSettings</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/settings/ClientConnectionSettings.html" title="org.apache.pekko.http.scaladsl.settings.ClientConnectionSettings"><code>ClientConnectionSettings</code></a></span> can be passed to all client-side entry points in <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/Http.html" title="org.apache.pekko.http.javadsl.Http"><code>Http</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/Http$.html" title="org.apache.pekko.http.scaladsl.Http"><code>Http</code></a></span>.</p>
<h2><a href="#predefined-transports" name="predefined-transports" class="anchor"><span class="anchor-link"></span></a>Predefined Transports</h2>
<h3><a href="#tcp" name="tcp" class="anchor"><span class="anchor-link"></span></a>TCP</h3>
<p>The default transport is <code>ClientTransport.TCP</code> which simply opens a TCP connection to the target host.</p>
<h3><a href="#http-s-proxy" name="http-s-proxy" class="anchor"><span class="anchor-link"></span></a>HTTP(S) Proxy</h3>
<p>A transport that connects to target servers via an HTTP(S) proxy. An HTTP(S) proxy uses the HTTP <code>CONNECT</code> method (as specified in <a href="https://tools.ietf.org/html/rfc7231#section-4.3.6">RFC 7231 Section 4.3.6</a>) to create tunnels to target servers. The proxy itself should transparently forward data to the target servers so that end-to-end encryption should still work (if TLS breaks, then the proxy might be fussing with your data).</p>
<p>This approach is commonly used to securely proxy requests to HTTPS endpoints. In theory it could also be used to proxy requests targeting HTTP endpoints, but we have not yet found a proxy that in fact allows this.</p>
<p>Instantiate the HTTP(S) proxy transport using <code>ClientTransport.httpsProxy(proxyAddress)</code>.</p>
<p>The proxy transport can also be setup using <code>ClientTransport.httpsProxy()</code> or <code>ClientTransport.httpsProxy(basicHttpCredentials)</code> In order to define the transport as such, you will need to set the proxy host / port in your <code>conf</code> file like the following.</p>
<pre><code>pekko.http.client.proxy {
 https {
   host = &quot;&quot;
   port = 443
 }
}
</code></pre>
<p>If host is left as <code>&quot;&quot;</code> and you attempt to setup an httpsProxy transport, an exception will be thrown.</p>
<a id="use-https-proxy-with-http-singlerequest"></a>
<h3><a href="#use-http-s-proxy-with-" name="use-http-s-proxy-with-" class="anchor"><span class="anchor-link"></span></a>Use HTTP(S) proxy with <span class="group-scala"><code>Http().singleRequest</code></span><span class="group-java"><code>Http.get(...).singleRequest</code></span></h3>
<p>To make use of an HTTP proxy when using the <code>singleRequest</code> API you simply need to configure the proxy and pass the appropriate settings object when calling the single request method.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/scala/docs/http/scaladsl/HttpClientExampleSpec.scala#L367-L383" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import java.net.InetSocketAddress

import org.apache.pekko
import pekko.actor.ActorSystem
import pekko.http.scaladsl.{ ClientTransport, Http }

implicit val system = ActorSystem()

val proxyHost = &quot;localhost&quot;
val proxyPort = 8888

val httpsProxyTransport = ClientTransport.httpsProxy(InetSocketAddress.createUnresolved(proxyHost, proxyPort))

val settings = ConnectionPoolSettings(system)
  .withConnectionSettings(ClientConnectionSettings(system)
    .withTransport(httpsProxyTransport))
Http().singleRequest(HttpRequest(uri = &quot;https://google.com&quot;), settings = settings)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/java/docs/http/javadsl/HttpClientExampleDocTest.java#L254-L268" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>final ActorSystem system = ActorSystem.create();

ClientTransport proxy = ClientTransport.httpsProxy(InetSocketAddress.createUnresolved(&quot;192.168.2.5&quot;, 8080));
ConnectionPoolSettings poolSettingsWithHttpsProxy = ConnectionPoolSettings.create(system)
    .withConnectionSettings(ClientConnectionSettings.create(system).withTransport(proxy));

final CompletionStage&lt;HttpResponse&gt; responseFuture =
    Http.get(system)
        .singleRequest(
              HttpRequest.create(&quot;https://github.com&quot;),
              Http.get(system).defaultClientHttpsContext(),
              poolSettingsWithHttpsProxy, // &lt;- pass in the custom settings here
              system.log());
</code></pre></dd>
</dl>
<h3><a href="#use-http-s-proxy-that-requires-authentication" name="use-http-s-proxy-that-requires-authentication" class="anchor"><span class="anchor-link"></span></a>Use HTTP(S) proxy that requires authentication</h3>
<p>In order to use an HTTP(S) proxy that requires authentication, you need to provide <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/model/headers/HttpCredentials.html" title="org.apache.pekko.http.javadsl.model.headers.HttpCredentials"><code>HttpCredentials</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/model/headers/HttpCredentials.html" title="org.apache.pekko.http.scaladsl.model.headers.HttpCredentials"><code>HttpCredentials</code></a></span> that will be used when making the CONNECT request to the proxy:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/scala/docs/http/scaladsl/HttpClientExampleSpec.scala#L400-L410" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko.http.scaladsl.model.headers

val proxyAddress = InetSocketAddress.createUnresolved(proxyHost, proxyPort)
val auth = headers.BasicHttpCredentials(&quot;proxy-user&quot;, &quot;secret-proxy-pass-dont-tell-anyone&quot;)

val httpsProxyTransport = ClientTransport.httpsProxy(proxyAddress, auth)

val settings = ConnectionPoolSettings(system)
  .withConnectionSettings(ClientConnectionSettings(system)
    .withTransport(httpsProxyTransport))
Http().singleRequest(HttpRequest(uri = &quot;http://pekko.apache.org&quot;), settings = settings)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/java/docs/http/javadsl/HttpClientExampleDocTest.java#L279-L295" target="_blank" title="Go to snippet source">source</a><code class="language-java">InetSocketAddress proxyAddress =
  InetSocketAddress.createUnresolved(&quot;192.168.2.5&quot;, 8080);
HttpCredentials credentials =
  HttpCredentials.createBasicHttpCredentials(&quot;proxy-user&quot;, &quot;secret-proxy-pass-dont-tell-anyone&quot;);

ClientTransport proxy = ClientTransport.httpsProxy(proxyAddress, credentials); // include credentials
ConnectionPoolSettings poolSettingsWithHttpsProxy = ConnectionPoolSettings.create(system)
    .withConnectionSettings(ClientConnectionSettings.create(system).withTransport(proxy));

final CompletionStage&lt;HttpResponse&gt; responseFuture =
    Http.get(system)
        .singleRequest(
              HttpRequest.create(&quot;https://github.com&quot;),
              Http.get(system).defaultClientHttpsContext(),
              poolSettingsWithHttpsProxy, // &lt;- pass in the custom settings here
              system.log());
</code></pre></dd>
</dl>
<h3><a href="#use-http-s-proxy-with-" name="use-http-s-proxy-with-" class="anchor"><span class="anchor-link"></span></a>Use HTTP(S) proxy with <span class="group-scala">Http().singleWebSocketRequest</span><span class="group-java">Http.get(&hellip;).singleWebSocketRequest</span></h3>
<p>Making use of an HTTP proxy when using the <code>singleWebSocketRequest</code> is done like using <code>singleRequest</code>, except you set <code>ClientConnectionSettings</code> instead of <code>ConnectionPoolSettings</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/scala/docs/http/scaladsl/WebSocketClientExampleSpec.scala#L135-L159" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import java.net.InetSocketAddress

import org.apache.pekko
import pekko.actor.ActorSystem
import pekko.NotUsed
import pekko.http.scaladsl.{ ClientTransport, Http }
import pekko.http.scaladsl.settings.ClientConnectionSettings
import pekko.http.scaladsl.model.ws._
import pekko.stream.scaladsl._

implicit val system = ActorSystem()

val flow: Flow[Message, Message, NotUsed] =
  Flow.fromSinkAndSource(
    Sink.foreach(println),
    Source.single(TextMessage(&quot;hello world!&quot;)))

val proxyHost = &quot;localhost&quot;
val proxyPort = 8888

val httpsProxyTransport = ClientTransport.httpsProxy(InetSocketAddress.createUnresolved(proxyHost, proxyPort))

val settings = ClientConnectionSettings(system).withTransport(httpsProxyTransport)
Http().singleWebSocketRequest(WebSocketRequest(uri = &quot;wss://example.com:8080/some/path&quot;), clientFlow = flow,
  settings = settings)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/java/docs/http/javadsl/WebSocketClientExampleTest.java#L256-L278" target="_blank" title="Go to snippet source">source</a><code class="language-java"><br/>final ActorSystem system = ActorSystem.create();
final Materializer materializer = ActorMaterializer.create(system);

final Flow&lt;Message, Message, NotUsed&gt; flow =
  Flow.fromSinkAndSource(
    Sink.foreach(System.out::println),
    Source.single(TextMessage.create(&quot;hello world&quot;)));

ClientTransport proxy = ClientTransport.httpsProxy(InetSocketAddress.createUnresolved(&quot;192.168.2.5&quot;, 8080));
ClientConnectionSettings clientSettingsWithHttpsProxy = ClientConnectionSettings.create(system)
  .withTransport(proxy);

Http.get(system)
  .singleWebSocketRequest(
    WebSocketRequest.create(&quot;wss://example.com:8080/some/path&quot;),
    flow,
    Http.get(system).defaultClientHttpsContext(),
    null,
    clientSettingsWithHttpsProxy, // &lt;- pass in the custom settings here
    system.log(),
    materializer);
</code></pre></dd>
</dl>
<h3><a href="#use-http-s-proxy-that-requires-authentication-for-web-sockets" name="use-http-s-proxy-that-requires-authentication-for-web-sockets" class="anchor"><span class="anchor-link"></span></a>Use HTTP(S) proxy that requires authentication for Web Sockets</h3>
<p>Here is an example for Web Socket:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/scala/docs/http/scaladsl/WebSocketClientExampleSpec.scala#L184-L193" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko.http.scaladsl.model.headers

val proxyAddress = InetSocketAddress.createUnresolved(proxyHost, proxyPort)
val auth = headers.BasicHttpCredentials(&quot;proxy-user&quot;, &quot;secret-proxy-pass-dont-tell-anyone&quot;)

val httpsProxyTransport = ClientTransport.httpsProxy(proxyAddress, auth)

val settings = ClientConnectionSettings(system).withTransport(httpsProxyTransport)
Http().singleWebSocketRequest(WebSocketRequest(uri = &quot;wss://example.com:8080/some/path&quot;), clientFlow = flow,
  settings = settings)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/java/docs/http/javadsl/WebSocketClientExampleTest.java#L294-L312" target="_blank" title="Go to snippet source">source</a><code class="language-java">InetSocketAddress proxyAddress =
  InetSocketAddress.createUnresolved(&quot;192.168.2.5&quot;, 8080);
HttpCredentials credentials =
  HttpCredentials.createBasicHttpCredentials(&quot;proxy-user&quot;, &quot;secret-proxy-pass-dont-tell-anyone&quot;);

ClientTransport proxy = ClientTransport.httpsProxy(proxyAddress, credentials); // include credentials
ClientConnectionSettings clientSettingsWithHttpsProxy = ClientConnectionSettings.create(system)
  .withTransport(proxy);

Http.get(system)
  .singleWebSocketRequest(
    WebSocketRequest.create(&quot;wss://example.com:8080/some/path&quot;),
    flow,
    Http.get(system).defaultClientHttpsContext(),
    null,
    clientSettingsWithHttpsProxy, // &lt;- pass in the custom settings here
    system.log(),
    materializer);
</code></pre></dd>
</dl>
<h2><a href="#custom-host-name-resolution-transport" name="custom-host-name-resolution-transport" class="anchor"><span class="anchor-link"></span></a>Custom Host Name Resolution Transport</h2>
<p>You can use <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/ClientTransport.html" title="org.apache.pekko.http.javadsl.ClientTransport"><code>ClientTransport.withCustomResolver</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/ClientTransport.html" title="org.apache.pekko.http.scaladsl.ClientTransport"><code>ClientTransport.withCustomResolver</code></a></span> to customize host name resolution. The given resolution function will be called for every connection attempt to resolve a hostname / port combination (potentially asynchronously) to an <code>InetSocketAddress</code>.</p>
<p>As a backend to implement the resolution function you can use Apache Pekko&rsquo;s <a href="https://doc.akka.io/docs/akka/current/io-dns.html#dns-extension">Async DNS Resolution</a>.</p>
<p>Potential use cases:</p>
<ul>
  <li>in a managed setting this can be used to query for <code>SRV</code> DNS records that contain both address and port for a service.</li>
  <li>if the DNS server returns multiple addresses, you can implement a load balancing algorithm to select a different target address for each connection</li>
</ul>
<h2><a href="#implementing-custom-transports" name="implementing-custom-transports" class="anchor"><span class="anchor-link"></span></a>Implementing Custom Transports</h2>
<p>Implement <code>ClientTransport.connectTo</code> to implement a custom client transport.</p>
<p>Here are some ideas for custom (or future predefined) transports:</p>
<ul>
  <li>SSH tunnel transport: connects to the target host through an SSH tunnel</li>
  <li>Per-host configurable transport: allows choosing transports per target host</li>
</ul>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/main/paradox/client-side/client-transport.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.0.0+4308-98f0ff9c*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../client-side/client-https-support.html" title="Client-Side HTTPS Support" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Client-Side HTTPS Support
</span>
</div>
</a>
<a href="../client-side/websocket-support.html" title="Client-Side WebSocket Support" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Client-Side WebSocket Support
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright © 2022, 2023 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0.
 This product contains significant parts that were originally based on software from Lightbend (<a href="https://akka.io/">Akka</a>).
 Copyright (C) 2009-2022 Lightbend Inc. &lt;https://www.lightbend.com&gt; Apache Pekko is derived from Akka 2.6.x,
 the last version that was distributed under the Apache License, Version 2.0 License.
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../assets/javascripts/groups.js"></script>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
