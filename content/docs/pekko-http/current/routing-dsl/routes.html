<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Apache Pekko Http: Modern, fast, asynchronous, streaming-first HTTP server and client.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Apache Pekko Http: Modern, fast, asynchronous, streaming-first HTTP server and client.">
<link rel="shortcut icon" href="../assets/images/pekko_favicon.png">
<title>Routes · Apache Pekko HTTP</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="../assets/stylesheets/pekko-theme.css">
</head>
<body
data-md-color-primary="white"
data-md-color-accent="orange"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Apache Pekko HTTP" class="md-header-nav__button md-logo">
<img src="../assets/images/pekko_logo.png" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Apache Pekko HTTP
</span>
<span class="md-header-nav__topic">
Routes
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/apache/incubator-pekko-http"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko-http
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Apache Pekko HTTP" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="../assets/images/pekko_logo.png" width="24" height="24">
</a>
<a href="../index.html" title="Apache Pekko HTTP">
Apache Pekko HTTP
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/apache/incubator-pekko-http"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
apache/incubator-pekko-http
</div>
</a>

</div>
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
<ul>
  <li><a href="../security.html" class="page">! Security Announcements !</a>
  <ul>
    <li><a href="../security.html#receiving-security-advisories" class="header">Receiving Security Advisories</a></li>
    <li><a href="../security.html#reporting-vulnerabilities" class="header">Reporting Vulnerabilities</a></li>
    <li><a href="../security.html#references" class="header">References</a></li>
  </ul></li>
  <li><a href="../release-notes/index.html" class="page">0. Release Notes</a></li>
  <li><a href="../introduction.html" class="page">1. Introduction</a>
  <ul>
    <li><a href="../introduction.html#philosophy" class="header">Philosophy</a></li>
    <li><a href="../introduction.html#using-apache-pekko-http" class="header">Using Apache Pekko HTTP</a></li>
    <li><a href="../introduction.html#routing-dsl-for-http-servers" class="header">Routing DSL for HTTP servers</a></li>
    <li><a href="../introduction.html#marshalling" class="header">Marshalling</a></li>
    <li><a href="../introduction.html#streaming" class="header">Streaming</a></li>
    <li><a href="../introduction.html#low-level-http-server-apis" class="header">Low-level HTTP server APIs</a></li>
    <li><a href="../introduction.html#http-client-api" class="header">HTTP Client API</a></li>
    <li><a href="../introduction.html#the-modules-that-make-up-apache-pekko-http" class="header">The modules that make up Apache Pekko HTTP</a></li>
  </ul></li>
  <li><a href="../usage.html" class="page">2. Usage</a>
  <ul>
    <li><a href="../configuration.html" class="page">Configuration</a></li>
    <li><a href="../migration-guide/index.html" class="page">Migration Guides</a></li>
    <li><a href="../compatibility-guidelines.html" class="page">Compatibility Guidelines</a></li>
  </ul></li>
  <li><a href="../common/index.html" class="page">3. Data Types &amp; Abstractions</a>
  <ul>
    <li><a href="../common/http-model.html" class="page">HTTP Model</a></li>
    <li><a href="../common/uri-model.html" class="page">The URI model</a></li>
    <li><a href="../common/marshalling.html" class="page">Marshalling</a></li>
    <li><a href="../common/unmarshalling.html" class="page">Unmarshalling</a></li>
    <li><a href="../common/encoding.html" class="page">Encoding / Decoding</a></li>
    <li><a href="../common/json-support.html" class="page">JSON Support</a></li>
    <li><a href="../common/xml-support.html" class="page">XML Support</a></li>
    <li><a href="../common/sse-support.html" class="page">Server-Sent Events Support</a></li>
    <li><a href="../common/timeouts.html" class="page">Timeouts</a></li>
    <li><a href="../common/caching.html" class="page">Caching</a></li>
  </ul></li>
  <li><a href="../server-side/index.html" class="page">4. Server API</a>
  <ul>
    <li><a href="../routing-dsl/index.html" class="page">Routing DSL</a></li>
    <li><a href="../server-side/low-level-api.html" class="page">Core Server API</a></li>
    <li><a href="../server-side/websocket-support.html" class="page">Server WebSocket Support</a></li>
    <li><a href="../server-side/server-https-support.html" class="page">Server HTTPS Support</a></li>
    <li><a href="../server-side/graceful-termination.html" class="page">Graceful termination</a></li>
    <li><a href="../server-side/http2.html" class="page">Server-Side HTTP/2 (Preview)</a></li>
  </ul></li>
  <li><a href="../client-side/index.html" class="page">5. Client API</a>
  <ul>
    <li><a href="../client-side/configuration.html" class="page">Configuration</a></li>
    <li><a href="../client-side/request-and-response.html" class="page">HttpRequest and HttpResponse</a></li>
    <li><a href="../client-side/request-level.html" class="page">Request-Level Client-Side API</a></li>
    <li><a href="../client-side/host-level.html" class="page">Host-Level Client-Side API</a></li>
    <li><a href="../client-side/connection-level.html" class="page">Connection-Level Client-Side API</a></li>
    <li><a href="../client-side/pool-overflow.html" class="page">Pool overflow and the max-open-requests setting</a></li>
    <li><a href="../client-side/client-https-support.html" class="page">Client-Side HTTPS Support</a></li>
    <li><a href="../client-side/client-transport.html" class="page">Pluggable Client Transports / HTTP(S) proxy Support</a></li>
    <li><a href="../client-side/websocket-support.html" class="page">Client-Side WebSocket Support</a></li>
    <li><a href="../client-side/http2.html" class="page">Client-Side HTTP/2 (Preview)</a></li>
  </ul></li>
  <li><a href="../extensions.html" class="page">6. Extensions</a></li>
  <li><a href="../technologies.html" class="page">7. Supported Technologies</a>
  <ul>
    <li><a href="../technologies.html#http" class="header">HTTP</a></li>
    <li><a href="../technologies.html#https" class="header">HTTPS</a></li>
    <li><a href="../technologies.html#websocket" class="header">WebSocket</a></li>
    <li><a href="../technologies.html#http-2" class="header">HTTP/2</a></li>
    <li><a href="../technologies.html#dns" class="header">DNS</a></li>
    <li><a href="../technologies.html#multipart" class="header">Multipart</a></li>
    <li><a href="../technologies.html#server-sent-events-sse-" class="header">Server-sent Events (SSE)</a></li>
    <li><a href="../technologies.html#json" class="header">JSON</a></li>
    <li><a href="../technologies.html#xml" class="header">XML</a></li>
    <li><a href="../technologies.html#gzip-and-deflate-content-encoding" class="header">Gzip and Deflate Content-Encoding</a></li>
  </ul></li>
  <li><a href="../tipsandtricks.html" class="page">8. Tips And Tricks</a>
  <ul>
    <li><a href="../troubleshooting/index.html" class="page">Troubleshooting</a></li>
    <li><a href="../handling-blocking-operations-in-pekko-http-routes.html" class="page">Handling blocking operations in Apache Pekko HTTP</a></li>
    <li><a href="../implications-of-streaming-http-entity.html" class="page">Implications of the streaming nature of Request/Response Entities</a></li>
  </ul></li>
  <li><a href="../contributing.html" class="page">9. Contributing</a>
  <ul>
    <li><a href="../contributing.html#welcome-" class="header">Welcome!</a></li>
    <li><a href="../contributing.html#snapshots" class="header">Snapshots</a></li>
  </ul></li>
  <li><a href="../reference.html" class="page">10. Reference</a>
  <ul>
    <li><a href="../reference.html#api-documentation" class="header">API Documentation</a></li>
    <li><a href="../reference.html#directives" class="header">Directives</a></li>
    <li><a href="../reference.html#books" class="header">Books</a></li>
  </ul></li>
</ul>

<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../routing-dsl/routes.html#routes" class="header">Routes</a>
  <ul>
    <li><a href="../routing-dsl/routes.html#requestcontext" class="header">RequestContext</a></li>
    <li><a href="../routing-dsl/routes.html#routeresult" class="header">RouteResult</a></li>
    <li><a href="../routing-dsl/routes.html#composing-routes" class="header">Composing Routes</a></li>
    <li><a href="../routing-dsl/routes.html#the-routing-tree" class="header">The Routing Tree</a></li>
    <li><a href="../routing-dsl/routes.html#sealing-a-route" class="header">Sealing a Route</a></li>
  </ul></li>
</ul>
</nav>


<ul class="md-nav__list md-nav__links">
<li class="md-nav__item"><a href="https://apache.org"><i class="md-icon">link</i> Apache Software Foundation</a></li>
<li class="md-nav__item"><a href="https://apache.org/licenses/"><i class="md-icon">link</i>&nbsp;License</a></li>
<li class="md-nav__item"><a href="https://apache.org/security/"><i class="md-icon">link</i>&nbsp;Security</a></li>
<li class="md-nav__item"><a href="https://www.apache.org/foundation/sponsorship.html"><i class="md-icon">link</i>&nbsp;Donate</a></li>
<li class="md-nav__item"><a href="https://www.apache.org/foundation/thanks.html"><i class="md-icon">link</i>&nbsp;Thanks</a></li>
</ul>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.0.0+4308-98f0ff9c*
</label>
</li>
</ul>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../routing-dsl/routes.html#routes" class="header">Routes</a>
  <ul>
    <li><a href="../routing-dsl/routes.html#requestcontext" class="header">RequestContext</a></li>
    <li><a href="../routing-dsl/routes.html#routeresult" class="header">RouteResult</a></li>
    <li><a href="../routing-dsl/routes.html#composing-routes" class="header">Composing Routes</a></li>
    <li><a href="../routing-dsl/routes.html#the-routing-tree" class="header">The Routing Tree</a></li>
    <li><a href="../routing-dsl/routes.html#sealing-a-route" class="header">Sealing a Route</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<a id="routes"></a>
<h1><a href="#routes" name="routes" class="anchor"><span class="anchor-link"></span></a>Routes</h1>
<p>The &ldquo;Route&rdquo; is the central concept of Apache Pekko HTTP&rsquo;s Routing DSL. All the structures you build with the DSL, no matter whether they consists of a single line or span several hundred lines, are <span class="group-scala"><code>type</code></span><span class="group-java"><code>function</code></span> turning a <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RequestContext.html" title="org.apache.pekko.http.javadsl.server.RequestContext"><code>RequestContext</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RequestContext.html" title="org.apache.pekko.http.scaladsl.server.RequestContext"><code>RequestContext</code></a></span> into a <span class="group-scala"><code>Future[RouteResult]</code></span><span class="group-java"><code>CompletionStage&lt;RouteResult&gt;</code></span>.</p><div class="group-scala">
<pre class="prettyprint"><code class="language-scala">type Route = RequestContext =&gt; Future[RouteResult]
</code></pre>
<p>It&rsquo;s a simple alias for a function turning a <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RequestContext.html" title="org.apache.pekko.http.javadsl.server.RequestContext"><code>RequestContext</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RequestContext.html" title="org.apache.pekko.http.scaladsl.server.RequestContext"><code>RequestContext</code></a></span> into a <code>Future[RouteResult]</code>.</p></div><div class="group-java">
<p>A <span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/index.html#Route=org.apache.pekko.http.scaladsl.server.RequestContext=%3Escala.concurrent.Future[org.apache.pekko.http.scaladsl.server.RouteResult]" title="org.apache.pekko.http.scaladsl.server"><code>Route</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/Route.html" title="org.apache.pekko.http.javadsl.server.Route"><code>Route</code></a></span> itself is a function that operates on a <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RequestContext.html" title="org.apache.pekko.http.javadsl.server.RequestContext"><code>RequestContext</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RequestContext.html" title="org.apache.pekko.http.scaladsl.server.RequestContext"><code>RequestContext</code></a></span> and returns a <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RouteResult.html" title="org.apache.pekko.http.javadsl.server.RouteResult"><code>RouteResult</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RouteResult.html" title="org.apache.pekko.http.scaladsl.server.RouteResult"><code>RouteResult</code></a></span>. The <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RequestContext.html" title="org.apache.pekko.http.javadsl.server.RequestContext"><code>RequestContext</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RequestContext.html" title="org.apache.pekko.http.scaladsl.server.RequestContext"><code>RequestContext</code></a></span> is a data structure that contains the current request and auxiliary data like the so far unmatched path of the request URI that gets passed through the route structure. It also contains the current <code>ExecutionContext</code> and <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/0.0/org/apache/pekko/stream/Materializer.html" title="org.apache.pekko.stream.Materializer"><code>Materializer</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/0.0/org/apache/pekko/stream/Materializer.html" title="org.apache.pekko.stream.Materializer"><code>Materializer</code></a></span>, so that these don&rsquo;t have to be passed around manually.</p></div>
<p>Generally when a route receives a request (or rather a <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RequestContext.html" title="org.apache.pekko.http.javadsl.server.RequestContext"><code>RequestContext</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RequestContext.html" title="org.apache.pekko.http.scaladsl.server.RequestContext"><code>RequestContext</code></a></span> for it) it can do one of these things:</p>
<ul>
  <li>Complete the request by returning the value of <code>requestContext.complete(...)</code></li>
  <li>Reject the request by returning the value of <code>requestContext.reject(...)</code> (see <a href="rejections.html#rejections">Rejections</a>)</li>
  <li>Fail the request by returning the value of <code>requestContext.fail(...)</code> or by just throwing an exception (see <a href="exception-handling.html#exception-handling">Exception Handling</a>)</li>
  <li>Do any kind of asynchronous processing and instantly return a <span class="group-scala"><code>Future[RouteResult]</code></span><span class="group-java"><code>CompletionStage&lt;RouteResult&gt;</code></span> to be eventually completed later</li>
</ul>
<p>The first case is pretty clear, by calling <code>complete</code> a given response is sent to the client as reaction to the request. In the second case &ldquo;reject&rdquo; means that the route does not want to handle the request. You&rsquo;ll see further down in the section about route composition what this is good for.</p>
<p>A <span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/index.html#Route=org.apache.pekko.http.scaladsl.server.RequestContext=%3Escala.concurrent.Future[org.apache.pekko.http.scaladsl.server.RouteResult]" title="org.apache.pekko.http.scaladsl.server"><code>Route</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/Route.html" title="org.apache.pekko.http.javadsl.server.Route"><code>Route</code></a></span> can be &ldquo;sealed&rdquo; using <code>Route.seal</code>, which relies on the in-scope <code>RejectionHandler</code> and <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/ExceptionHandler.html" title="org.apache.pekko.http.javadsl.server.ExceptionHandler"><code>ExceptionHandler</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/ExceptionHandler.html" title="org.apache.pekko.http.scaladsl.server.ExceptionHandler"><code>ExceptionHandler</code></a></span> instances to convert rejections and exceptions into appropriate HTTP responses for the client. <a href="routes.html#sealing-a-route">Sealing a Route</a> is described more in detail later. </p>
<p>Using <code>Route.toFlow</code> or <code>Route.toFunction</code> a <span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/index.html#Route=org.apache.pekko.http.scaladsl.server.RequestContext=%3Escala.concurrent.Future[org.apache.pekko.http.scaladsl.server.RouteResult]" title="org.apache.pekko.http.scaladsl.server"><code>Route</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/Route.html" title="org.apache.pekko.http.javadsl.server.Route"><code>Route</code></a></span> can be lifted into a handler <span class="group-java"><a href="https://pekko.apache.org/japi/pekko/0.0/org/apache/pekko/stream/javadsl/Flow.html" title="org.apache.pekko.stream.javadsl.Flow"><code>Flow</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/0.0/org/apache/pekko/stream/scaladsl/Flow.html" title="org.apache.pekko.stream.scaladsl.Flow"><code>Flow</code></a></span> or async handler function to be used with a <code>bindAndHandleXXX</code> call from the <a href="../server-side/low-level-api.html">Core Server API</a>.</p>
<p>Note: There is also an implicit conversion from <span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/index.html#Route=org.apache.pekko.http.scaladsl.server.RequestContext=%3Escala.concurrent.Future[org.apache.pekko.http.scaladsl.server.RouteResult]" title="org.apache.pekko.http.scaladsl.server"><code>Route</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/Route.html" title="org.apache.pekko.http.javadsl.server.Route"><code>Route</code></a></span> to <span class="group-java"><a href="https://pekko.apache.org/japi/pekko/0.0/org/apache/pekko/stream/javadsl/Flow.html" title="org.apache.pekko.stream.javadsl.Flow"><code>Flow&lt;HttpRequest, HttpResponse, Unit&gt;</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/api/pekko/0.0/org/apache/pekko/stream/scaladsl/Flow.html" title="org.apache.pekko.stream.scaladsl.Flow"><code>Flow[HttpRequest, HttpResponse, Unit]</code></a></span> defined in the <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RouteResult.html" title="org.apache.pekko.http.javadsl.server.RouteResult"><code>RouteResult</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RouteResult.html" title="org.apache.pekko.http.scaladsl.server.RouteResult"><code>RouteResult</code></a></span> companion, which relies on <code>Route.toFlow</code>.</p>
<a id="requestcontext"></a>
<h2><a href="#requestcontext" name="requestcontext" class="anchor"><span class="anchor-link"></span></a>RequestContext</h2>
<p>The request context wraps an <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/model/HttpRequest.html" title="org.apache.pekko.http.javadsl.model.HttpRequest"><code>HttpRequest</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/model/HttpRequest.html" title="org.apache.pekko.http.scaladsl.model.HttpRequest"><code>HttpRequest</code></a></span> instance to enrich it with additional information that are typically required by the routing logic, like an <code>ExecutionContext</code>, <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/0.0/org/apache/pekko/stream/Materializer.html" title="org.apache.pekko.stream.Materializer"><code>Materializer</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/0.0/org/apache/pekko/stream/Materializer.html" title="org.apache.pekko.stream.Materializer"><code>Materializer</code></a></span>, <span class="group-scala"><a href="https://pekko.apache.org/api/pekko/0.0/org/apache/pekko/event/LoggingAdapter.html" title="org.apache.pekko.event.LoggingAdapter"><code>LoggingAdapter</code></a></span><span class="group-java"><a href="https://pekko.apache.org/japi/pekko/0.0/org/apache/pekko/event/LoggingAdapter.html" title="org.apache.pekko.event.LoggingAdapter"><code>LoggingAdapter</code></a></span> and the configured <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/settings/RoutingSettings.html" title="org.apache.pekko.http.javadsl.settings.RoutingSettings"><code>RoutingSettings</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/settings/RoutingSettings.html" title="org.apache.pekko.http.scaladsl.settings.RoutingSettings"><code>RoutingSettings</code></a></span>. It also contains the <code>unmatchedPath</code>, a value that describes how much of the request URI has not yet been matched by a <a href="directives/path-directives/index.html#pathdirectives">Path Directive</a>.</p>
<p>The <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RequestContext.html" title="org.apache.pekko.http.javadsl.server.RequestContext"><code>RequestContext</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RequestContext.html" title="org.apache.pekko.http.scaladsl.server.RequestContext"><code>RequestContext</code></a></span> itself is immutable but contains several helper methods which allow for convenient creation of modified copies.</p>
<a id="routeresult"></a>
<h2><a href="#routeresult" name="routeresult" class="anchor"><span class="anchor-link"></span></a>RouteResult</h2>
<p><span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RouteResult.html" title="org.apache.pekko.http.javadsl.server.RouteResult"><code>RouteResult</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RouteResult.html" title="org.apache.pekko.http.scaladsl.server.RouteResult"><code>RouteResult</code></a></span> is a simple algebraic data type (ADT) that models the possible non-error results of a <span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/index.html#Route=org.apache.pekko.http.scaladsl.server.RequestContext=%3Escala.concurrent.Future[org.apache.pekko.http.scaladsl.server.RouteResult]" title="org.apache.pekko.http.scaladsl.server"><code>Route</code></a></span><span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/Route.html" title="org.apache.pekko.http.javadsl.server.Route"><code>Route</code></a></span>. It is defined as such:</p><div class="group-scala">
<pre class="prettyprint"><code class="language-scala">sealed trait RouteResult

object RouteResult {
  final case class Complete(response: HttpResponse) extends RouteResult
  final case class Rejected(rejections: immutable.Seq[Rejection]) extends RouteResult
}
</code></pre></div>
<p>Usually you don&rsquo;t create any <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/RouteResult.html" title="org.apache.pekko.http.javadsl.server.RouteResult"><code>RouteResult</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/server/RouteResult.html" title="org.apache.pekko.http.scaladsl.server.RouteResult"><code>RouteResult</code></a></span> instances yourself, but rather rely on the pre-defined <a href="directives/route-directives/index.html#routedirectives">RouteDirectives</a> (like <a href="directives/route-directives/complete.html#complete">complete</a>, <a href="directives/route-directives/reject.html#reject">reject</a> or <a href="directives/route-directives/redirect.html#redirect">redirect</a>) or the respective methods on the <a href="#requestcontext">RequestContext</a> instead.</p>
<h2><a href="#composing-routes" name="composing-routes" class="anchor"><span class="anchor-link"></span></a>Composing Routes</h2>
<p>There are three basic operations we need for building more complex routes from simpler ones:</p>
<ul>
  <li>Route transformation, which delegates processing to another, &ldquo;inner&rdquo; route but in the process changes some properties of either the incoming request, the outgoing response or both</li>
  <li>Route filtering, which only lets requests satisfying a given filter condition pass and rejects all others</li>
  <li>Route chaining, which tries a second route if a given first one was rejected</li>
</ul>
<p>The first two points are provided by so-called <a href="directives/index.html#directives">Directives</a> of which a large number is already predefined by Apache Pekko HTTP and is extensible with user code.</p>
<p>The last point is achieved with the <code>concat</code> method.</p>
<p><a href="directives/index.html#directives">Directives</a> deliver most of Apache Pekko HTTP&rsquo;s power and flexibility.</p>
<h2><a href="#the-routing-tree" name="the-routing-tree" class="anchor"><span class="anchor-link"></span></a>The Routing Tree</h2>
<p>Essentially, when you combine directives and custom routes via the <code>concat</code> method, you build a routing structure that forms a tree. When a request comes in it is injected into this tree at the root and flows down through all the branches in a depth-first manner until either some node completes it or it is fully rejected.</p>
<p>Consider this schematic example:</p><div class="group-scala">
<pre class="prettyprint"><code class="language-scala">val route =
  a {
    concat(
      b {
        concat(
          c {
            ... // route 1
          },
          d {
            ... // route 2
          },
          ... // route 3
        )
      },
      e {
        ... // route 4
      }
    )
  }
</code></pre></div><div class="group-java">
<pre class="prettyprint"><code class="language-java">import static org.apache.http.javadsl.server.Directives.*;

Route route =
  directiveA(concat(() -&gt;
    directiveB(concat(() -&gt;
      directiveC(
        ... // route 1
      ),
      directiveD(
        ... // route 2
      ),
      ... // route 3
    )),
    directiveE(
      ... // route 4
    )
  ));
</code></pre></div>
<p>Here five directives form a routing tree.</p>
<ul>
  <li>Route 1 will only be reached if directives <code>a</code>, <code>b</code> and <code>c</code> all let the request pass through.</li>
  <li>Route 2 will run if <code>a</code> and <code>b</code> pass, <code>c</code> rejects and <code>d</code> passes.</li>
  <li>Route 3 will run if <code>a</code> and <code>b</code> pass, but <code>c</code> and <code>d</code> reject.</li>
</ul>
<p>Route 3 can therefore be seen as a &ldquo;catch-all&rdquo; route that only kicks in, if routes chained into preceding positions reject. This mechanism can make complex filtering logic quite easy to implement: simply put the most specific cases up front and the most general cases in the back.</p>
<h2><a href="#sealing-a-route" name="sealing-a-route" class="anchor"><span class="anchor-link"></span></a>Sealing a Route</h2>
<p>A sealed route has these properties:</p>
<ul>
  <li>The result of the route will always be a complete response, i.e. the result of the future is a <code>Success(RouteResult.Complete(response))</code>, never a failed future and never a rejected route.</li>
  <li>Consequently, no route alternatives will be tried that were combined with this route.</li>
</ul>
<p>As described in <a href="rejections.html">Rejections</a> and <a href="exception-handling.html">Exception Handling</a>, there are generally two ways to handle rejections and exceptions.</p>
<ul>
  <li>Bring rejection/exception handlers <span class="group-scala"><code>into implicit scope at the top-level</code></span><span class="group-java"><code>seal()</code> method of the <a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/server/Route.html" title="org.apache.pekko.http.javadsl.server.Route"><code>Route</code></a></span></li>
  <li>Supply handlers as arguments to <a href="directives/execution-directives/handleRejections.html#handlerejections">handleRejections</a> and <a href="directives/execution-directives/handleExceptions.html#handleexceptions">handleExceptions</a> directives</li>
</ul>
<p>In the first case your handlers will be &ldquo;sealed&rdquo;, (which means that it will receive the default handler as a fallback for all cases your handler doesn&rsquo;t handle itself) and used for all rejections/exceptions that are not handled within the route structure itself.</p>
<h3><a href="#route-seal-method-to-modify-httpresponse" name="route-seal-method-to-modify-httpresponse" class="anchor"><span class="anchor-link"></span></a>Route.seal() method to modify HttpResponse</h3>
<p>In application code, unlike <a href="testkit.html#testing-sealed-routes">test code</a>, you don&rsquo;t need to use the <code>Route.seal()</code> method to seal a route. As long as you bring implicit rejection and/or exception handlers to the top-level scope, your route is sealed. </p>
<p>However, you can use <code>Route.seal()</code> to perform modification on <span class="group-java"><a href="https://pekko.apache.org/api/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/javadsl/model/HttpResponse.html" title="org.apache.pekko.http.javadsl.model.HttpResponse"><code>HttpResponse</code></a></span><span class="group-scala"><a href="https://pekko.apache.org/japi/pekko-http/0.0.0+4308-98f0ff9c-SNAPSHOT/org/apache/pekko/http/scaladsl/model/HttpResponse$.html" title="org.apache.pekko.http.scaladsl.model.HttpResponse"><code>HttpResponse</code></a></span> from the route. For example, if you want to add a special header, but still use the default rejection handler, then you can do the following. In the below case, the special header is added to rejected responses which did not match the route, as well as successful responses which matched the route.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/scala/docs/http/scaladsl/RouteSealExampleSpec.scala#L25-L34" target="_blank" title="Go to snippet source">source</a><code class="language-scala">val route = respondWithHeader(RawHeader(&quot;special-header&quot;, &quot;you always have this even in 404&quot;)) {
  Route.seal(
    get {
      pathSingleSlash {
        complete {
          &quot;Captain on the bridge!&quot;
        }
      }
    })
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/test/java/docs/http/javadsl/RouteSealExample.java#L26-L50" target="_blank" title="Go to snippet source">source</a><code class="language-java">public class RouteSealExample extends AllDirectives {

  public static void main(String [] args) {
    RouteSealExample app = new RouteSealExample();
    app.runServer();
  }

  public void runServer(){
    ActorSystem system = ActorSystem.create();

    Route sealedRoute = get(
      () -&gt; pathSingleSlash( () -&gt;
        complete(&quot;Captain on the bridge!&quot;)
      )
    ).seal();

    Route route = respondWithHeader(
      RawHeader.create(&quot;special-header&quot;, &quot;you always have this even in 404&quot;),
      () -&gt; sealedRoute
    );

    final Http http = Http.get(system);
    final CompletionStage&lt;ServerBinding&gt; binding = http.newServerAt(&quot;localhost&quot;, 8080).bind(route);
  }
}</code></pre></dd>
</dl>
<h3><a href="#converting-routes-between-java-and-scala-dsls" name="converting-routes-between-java-and-scala-dsls" class="anchor"><span class="anchor-link"></span></a>Converting routes between Java and Scala DSLs</h3>
<p>In some cases when building reusable libraries that expose routes, it may be useful to be able to convert routes between their Java and Scala DSL representations. You can do so using the <code>asScala</code> method on a Java DSL route, or by using an <code>RouteAdapter</code> to wrap an Scala DSL route. </p>
<p>Converting Scala DSL routes to Java DSL:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/http-tests/src/test/scala/org/apache/pekko/http/scaladsl/RouteJavaScalaDslConversionSpec.scala#L43-L51" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko

val scalaRoute: pekko.http.scaladsl.server.Route =
  pekko.http.scaladsl.server.Directives.get {
    pekko.http.scaladsl.server.Directives.complete(&quot;OK&quot;)
  }

val javaRoute: pekko.http.javadsl.server.Route =
  pekko.http.javadsl.server.directives.RouteAdapter.asJava(scalaRoute)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/http-tests/src/test/java/docs/http/javadsl/server/RouteJavaScalaDslConversionTest.java#L29-L34" target="_blank" title="Go to snippet source">source</a><code class="language-java">scala.Function1&lt;
    org.apache.pekko.http.scaladsl.server.RequestContext,
    scala.concurrent.Future&lt;org.apache.pekko.http.scaladsl.server.RouteResult&gt;&gt; scalaRoute = someRoute();

org.apache.pekko.http.javadsl.server.Route javaRoute =
    RouteAdapter.asJava(scalaRoute);</code></pre></dd>
</dl>
<p>Converting Java DSL routes to Scala DSL:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/http-tests/src/test/scala/org/apache/pekko/http/scaladsl/RouteJavaScalaDslConversionSpec.scala#L28-L37" target="_blank" title="Go to snippet source">source</a><code class="language-scala">import org.apache.pekko

val javaRoute =
  pekko.http.javadsl.server.Directives.get(new Supplier[pekko.http.javadsl.server.Route] {
    override def get(): Route = pekko.http.javadsl.server.Directives.complete(&quot;ok&quot;)
  })

// Remember that Route in Scala is just a type alias:
//   type Route = RequestContext =&gt; Future[RouteResult]
val scalaRoute: pekko.http.scaladsl.server.Route = javaRoute.asScala</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><button class="snippet-button copy-snippet" title="Copy snippet to clipboard">copy</button><a class="snippet-button go-to-source" href="https://github.com/apache/incubator-pekko-http/tree/main/http-tests/src/test/java/docs/http/javadsl/server/RouteJavaScalaDslConversionTest.java#L40-L45" target="_blank" title="Go to snippet source">source</a><code class="language-java">Route javaRoute = Directives.get(() -&gt;
    Directives.complete(&quot;okey&quot;)
);

scala.Function1&lt;RequestContext, Future&lt;RouteResult&gt;&gt; scalaRoute =
    javaRoute.asScala();</code></pre></dd>
</dl>
</div>
<div>
<a href="https://github.com/apache/incubator-pekko-http/tree/main/docs/src/main/paradox/routing-dsl/routes.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.0.0+4308-98f0ff9c*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../routing-dsl/play-comparison.html" title="Compared with Play routes" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Compared with Play routes
</span>
</div>
</a>
<a href="../routing-dsl/directives/index.html" title="Directives" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Directives
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
Copyright © 2022, 2023 <a href="https://apache.org">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0.
 This product contains significant parts that were originally based on software from Lightbend (<a href="https://akka.io/">Akka</a>).
 Copyright (C) 2009-2022 Lightbend Inc. &lt;https://www.lightbend.com&gt; Apache Pekko is derived from Akka 2.6.x,
 the last version that was distributed under the Apache License, Version 2.0 License.
</div>
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../assets/javascripts/groups.js"></script>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
